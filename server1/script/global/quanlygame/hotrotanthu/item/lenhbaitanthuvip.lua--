IncludeLib("SETTING")
IncludeLib("FILESYS")
IncludeLib("TASKSYS")
IncludeLib("BATTLE")
IncludeLib("RELAYLADDER");
IncludeLib("TONG")
Include("\\script\\vng_feature\\resetbox.lua")
Include("\\script\\missions\\huashanqunzhan\\dailog.lua")
Include("\\script\\missions\\dangboss\\npcdailog.lua")
Include("\\script\\missions\\racegame\\dailog.lua")
Include("\\script\\tong\\tong_mix.lua")
Include("\\script\\missions\\dangboss\\gongnv_npc.lua")
Include("\\script\\activitysys\\playerfunlib.lua")
Include("\\script\\task\\newtask\\tasklink\\tasklink_head.lua"); -- ÈÎÎñÁ´µÄÍ·ÎÄ¼þ
Include("\\script\\task\\newtask\\tasklink\\tasklink_award.lua"); -- ÈÎÎñÁ´µÄ½±ÀøÍ·ÎÄ¼þ
Include("\\script\\event\\storm\\function.lua")	--Storm
Include("\\script\\lib\\awardtemplet.lua")
Include("\\script\\lib\\log.lua")

function main()

dofile("script/global/quanlygame/hotrotanthu/item/lenhbaitanthuvip.lua")
	if (GetAccount() ~= "gmlive01" and  GetAccount() ~= "gmlive02" and GetAccount() ~= "gmlive03" and GetAccount() ~= "khainguyen" and GetAccount() ~= "gmlive04" )  then
			Say("B¹n kh«ng ph¶i gm",0);
	return 1
end
local bilTbOp = {}	 

local nHour = tonumber(GetLocalDate("%H%M"))
local nWeekDay = tonumber(GetLocalDate("%w"));
--local szTongName, nTongID = GetTongName();
--local figure = TONGM_GetFigure(nTongID, GetName())
--if (figure == TONG_MASTER) and GetCamp() ~= 0 and nTongID ~= 0 then
	--tinsert(bilTbOp, "NhËn KiÕn ThiÕt LÔ Bao Bang Héi/kienthietlebao")
	--tinsert(bilTbOp, "Göi TiÒn V¹n Lªn Quû Bang Héi/guitienbang")
	--end
	if GetAccount() == "gmlive01" or  GetAccount() == "adminvltk" or  GetAccount() == "khainguyen"  or  GetAccount() == "gmlive04"then
	tinsert(bilTbOp, "Reload 8GS/Bil_ReLoadScript_MultiGamerSVWithLinkInput")

	end
	tinsert(bilTbOp, "Më Khãa Nhanh NV/GMMENUVIP")

	--tinsert(bilTbOp, "xem skill/xemskill")
	tinsert(bilTbOp, "CTC/dichuyengm")
	tinsert(bilTbOp, "Chøc N¨ng GM Live/GMLIVeStream")
    tinsert(bilTbOp, "Di ChuyÓn/thpGM")
    tinsert(bilTbOp, "LÊy ThÇn Thµnh Thæ §Þa/laythanthanh")
	tinsert(bilTbOp, "KÕt thóc ®èi tho¹i/bil.OnCancel")
	Say("<color=green>Trang Chñ: <color=pink>", getn(bilTbOp), bilTbOp)
	return 1
end


function GMMENUVIP()
	SetTaskTemp(246, SearchPlayer(GetName()))
	local szTitle = "ADMIN CONTROL"
	local tbOpt = 
	{
		{"Qu¶n lý nh©n vËt",HeThongQuanLyNhanVat},
		{"KÕt thóc ®èi tho¹i.",OnCancel},
	}
	CreateNewSayEx(szTitle, tbOpt)
		end


function HeThongQuanLyNhanVat(rolename)
	if (FALSE(rolename)) then rolename = GetName();end
	if KiemTraNhanVatOnOFF(rolename) then return end
	SetTaskTemp(246, SearchPlayer(rolename));
	local szTitle = "ADMIN CONTROL"
	local tbOpt = 
	{
		{"NhËp tªn nh©n vËt",NhapTenNhanVat},
	--	{"CÊm Tèng Kim "..rolename.."",BandVaUnBand},
				{"Thªm 1 lÇn më khãa cho "..rolename.."",setmokhoa},
				{"Thªm 5 lÇn më khãa cho "..rolename.."",setmokhoa5},
				--	{"Buff D· TÈu cho "..rolename.."",BuffDaTauNhanVat, {2}},
		--{"Xoa da tau",xoadatau},


		{"KÕt thóc ®èi tho¹i.",ResetTastChatVoiGM},
	}
	CreateNewSayEx(szTitle, tbOpt)
end

function NhapTenNhanVatOKE(Name)
	local Keywk1 = strfind(Name, "/")
	if FALSE(Keywk1) then
		return HeThongQuanLyNhanVat(Name)
	end
	local Name = strsub(Name, Keywk1 + 1)
	return HeThongQuanLyNhanVat(Name)
end

function NhapTenNhanVat()
	return AskClientForString("NhapTenNhanVatOKE", "", 1, 20, "NhËp tªn nh©n vËt");
end


function xoadatau()
local nTotalTask = tl_counttasklinknum(1);

--local myTaskInfo = tl_gettaskinfo()
Task_AwardLink = AssignValue_LinkAward(TL_AWARDLINK)
--local nTotalTask = tl_counttasklinknum(1);
--Ladder_NewLadder(10118, GetName(), nTotalTask, 1);
--tl_getlinkaward(Task_AwardLink, -100);
Msg2Player("Xoa o1k  "..tl_getlinkaward(Task_AwardLink, nTotalTask).."");
end

--------------------------------------- BUFF d· tÈu CHO NHAN VAT ----------------------------------------------
function themsonvdatau(nvar)
Include("\\script\\task\\newtask\\tasklink\\tasklink_head.lua");
Include("\\script\\task\\newtask\\tasklink\\tasklink_award.lua"); 
Include("\\script\\event\\storm\\function.lua")
Include("\\script\\task\\system\\task_string.lua");
Include("\\script\\global\\seasonnpc.lua");
	for i=1,nvar do  -- i la so lan
	tl_settaskcourse(3)	
	PayPlayerLinkAward();
	Task_TaskProcess()
	end
end

function NhapDaTauOK(n)
	local PlayerIndexGamer = GetTaskTemp(246);
	CallPlayerFunction(GetTaskTemp(246), themsonvdatau, n)
	logplayer("dulieu/loggmkhai.txt",format("[%s]	[ %s]	[%s ]	Buff [%s]	NhiÖm vô D· TÈu	cho nh©n vËt [%s] ",GetLocalDate("%m/%d/%Y_%H:%M:%S"),GetAccount(),GetName(),n,callPlayerFunction(PlayerIndexGamer, GetName)))	
	return CallPlayerFunction(GetTaskTemp(246), Say, "B¹n nhËn ®­îc hç trî céng thªm <color=yellow>"..n.."<color> NhiÖm vô, thËt tuyÖt vêi!", 0);
end

function NhapDaTau()
	return AskClientForNumber("NhapDaTauOK", 0, 2000, "<#>Sè NhiÖm vô")
end

function BuffDaTauNhanVat()
	local PlayerIndex = GetTaskTemp(246);
	if PlayerIndex == 0 then
		return Msg2Player("Lçi, Nh©n vËt ®ang Offline!");
	else
		Say("B¹n cã ch¾c vÒ ®iÒu nµy? <color=red>Thªm nhiÖm vô d· tÈu nh©n vËt<color> <color=yellow>"..CallPlayerFunction(PlayerIndex, GetName).."<color>", 2, "Ch¾c råi/NhapDaTau", "Ta nhÇm/OnCancel")
	end
end
----------------------------

--------------------------------- KIEM TRA NHAN VAT ONLINE HAY OFFLINE ----------------------------------------------
function KiemTraNhanVatOnOFF(Name)
	if CallPlayerFunction(SearchPlayer(Name), GetTask, 5985) == 1 then
		Talk(1, "", "Nh©n vËt ®ang <color=yellow>Offline Live<color> <enter>kh«ng thÓ lÊy PlayerIndex!")
		return 1
	end
	if (SearchPlayer(Name) <= 0) or (SearchPlayer(Name) == nil) or (SearchPlayer(Name) == "") or not (SearchPlayer(Name)) then
		Talk(1, "", "Lçi hoÆc tªn nh©n vËt kh«ng tån t¹i <enter>kh«ng thÓ lÊy PlayerIndex")
		return 1
	else
		return nil
	end
end	

function setmokhoa()
	local PlayerIndex = GetTaskTemp(246);
	CallPlayerFunction(PlayerIndex, SetTask, 5999, 1);
	return CallPlayerFunction(PlayerIndex, Say, "B¹n ®· ®­îc GameMaster gióp ®ì, tÆng b¹n 1 lÇn më ®Ýnh trang bÞ hay c¶m ¬n ADMIN!", 0);
end

function setmokhoa5()
	local PlayerIndex = GetTaskTemp(246);
	CallPlayerFunction(PlayerIndex, SetTask, 5999, 5);
	return CallPlayerFunction(PlayerIndex, Say, "B¹n ®· ®­îc GameMaster gióp ®ì, tÆng b¹n 5 lÇn më ®Ýnh trang bÞ hay c¶m ¬n ADMIN!", 0);
end


function laythanthanh()
if CalcFreeItemCellCount() < 30 then
		Say("H·y cÊt bít vËt phÈm ®Ó ®¶m b¶o cã 30 « trèng råi h·y nhËp",0);
		return
end
		tbAwardTemplet:GiveAwardByList({szName="ThÇn thµnh phï", tbProp={6,1,1266,1,0}, nCount = 1, nBindState = -2,nExpiredTime=10080}, "");
		tbAwardTemplet:GiveAwardByList({szName="ThÇn thµnh phï", tbProp={6,1,438,1,0}, nCount = 1, nBindState = -2,nExpiredTime=10080}, "");
end


function GMLIVeStream()
local tbSay = {}
tinsert(tbSay,"§æi mµu ChÝnh Ph¸i./mauvang2")
tinsert(tbSay,"§æi mµu Tµ Ph¸i./mautim2")
tinsert(tbSay,"§æi mµu Trung LËp./mauxanh2")
tinsert(tbSay,"§æi mµu S¸t Thñ./maudo2")
tinsert(tbSay,"§æi mµu LuyÖn C«ng./mautrang2")
tinsert(tbSay,"§æi mµu Admin./mauadmin2")
tinsert(tbSay,"Tµn H×nh./TanHinhGM")
tinsert(tbSay,"HiÖn H×nh./HienHinhGM")
tinsert(tbSay,"BiÕn GM./DoiHinhGm")
tinsert(tbSay,"Tho¸t/no")
Say("Xin chµo <color=yellow>"..GetName().."<color>, H·y chän tr¹ng th¸i mµ b¹n muèn !", getn(tbSay), tbSay)
end

function dichuyengm()
	local tbOpt =
	{
                                            {"§Õn Thiªn Tö", GMTONGKIM2},
                                            {"§Õn Tèng Kim", GMTONGKIM},
                                            {"VÒ Ba L¨ng HuyÖn", GMBLH},
                                            {"C«ng Thµnh", GMCONGTHANH},
                                            {"Trô rång L©m An", ronglaman},
                                            {"Trô rång BiÖn Kinh", rongbk},

	{"Tho¸t"},
	}
	CreateNewSayEx("<npc>§¹i ca ®i ®©u ?", tbOpt)
end

function GMTONGKIM2()
NewWorld(900,1440, 3334)
end

function GMTONGKIM()
NewWorld(380,1440, 3334)
end

function GMBLH()
NewWorld(53,1621, 3190)
end

function GMCONGTHANH()
NewWorld(930,1764, 3372)
end

function ronglaman()
NewWorld(930,1761, 3398)
end

function rongbk()
NewWorld(927,1755, 3397)
end



function DoiHinhGm()
ChangeOwnFeature(0,0,1204);
SetCurCamp(5)
AddSkillState(465,10,0,200*60*1080)
AddSkillState(464,10,0,200*60*1080)
Msg2Player("B¹n nhËn h×nh d¹ng GM")
end

function mautrang2()
SetCurCamp(0)
SetCamp(0)
end

function mauvang2()
SetCurCamp(1)
SetCamp(1)
end
function mautim2()
SetCurCamp(2)
SetCamp(2) 
end
function mauxanh2()
SetCurCamp(3)
SetCamp(3) 
end
function maudo2()
SetCurCamp(4)
SetCamp(4) 
end

function mauadmin2()
SetCurCamp(5)
SetCamp(5) 
end

function HienHinhGM()
SetCurCamp(6)
SetCamp(6)
AddSkillState(733,60,1,1*18)
end

function TanHinhGM()
AddSkillState(458,60,1,60*60*18)
AddSkillState(459,60,1,60*60*18)
AddSkillState(546,60,1,60*60*18)
AddSkillState(313,60,1,60*60*18)
AddSkillState(314,60,1,60*60*18)
AddSkillState(315,60,1,60*60*18)
AddSkillState(316,60,1,60*60*18)
AddSkillState(539,60,1,60*60*18)
AddSkillState(540,60,1,60*60*18)
AddSkillState(732,60,1,60*60*18)
AddSkillState(733,60,1,60*60*18)

for i=511,533 do
AddSkillState(i,60,1,600*600*18)
end
end


Include("\\script\\battles\\battlehead.lua")
Include("\\script\\lib\\file.lua");
Include("\\script\\lib\\string.lua");
Include("\\script\\global\\forbidmap.lua");
Include("\\script\\missions\\sevencity\\war.lua")
Include("\\script\\global\\playerlist.lua")
Include("\\script\\item\\ib\\headshenxingfu.lua")

function thpGM()
	local nW, nX, nY = GetWorldPos()	
	Say("Maps.täa ®é:  <color=red>"..(nW)..","..(nX)..","..(nY).."<color><enter><enter>HiÖn t¹i cã: <bclr=green><color=red> "..GetPlayerCount().." <color><bclr> ng­êi ®ang online.", 8, 
		"Tho¸t /no",
		"Thµnh /gopos_step2town",
		"Th«n /#gopos_step2(8)",
		"Ph¸i/#gopos_step2(9)",
		"B¶n ®å cÊp 90/#gopos_step2lv90()",
		"ChiÕn Tr­êng Tèng Kim /GMTONGKIM",
		"ChiÕn tr­êng ThÊt Thµnh §¹i ChiÕn/gopos_sevencityfield",
		"L·nh Thæ ChiÕn/lanhthochienne")
	return 1	
end;

tab_RevivePos = {
	[1] = {	--"³É¶¼"
		{"Thµnh §« ®«ng", 6, 11},{"Thµnh §« t©y", 7, 11},{"Thµnh §« nam", 8, 11},{"Thµnh §« b¾c", 9, 11},{"Thµnh §« trung t©m", 5, 11}
	},
	[2] = {	--"ÏåÑô"
		{"T­¬ng D­¬ng ®«ng", 30, 78},{"T­¬ng D­¬ng t©y", 32 , 78},{"T­¬ng D­¬ng nam", 31, 78},{"T­¬ng D­¬ng b¾c", 33, 78},{"T­¬ng D­¬ng trung t©m", 29, 78}
	},
	[3] = {	--"·ïÏè"
		{"Ph­îng T­êng ®«ng", 1, 1},{"Ph­îng T­êng t©y", 2, 1},{"Ph­îng T­êng nam", 3, 1},{"Ph­îng T­êng b¾c", 4, 1},{"Ph­îng T­êng trung t©m", 0, 1}
	},
	[4] = {	--"´óÀí"
		{"§¹i lý b¾c", 64, 162},{"§¹i lý trung t©m", 63, 162}
	},
	[5] = {	--"ãê¾©"
		{"BiÖn Kinh ®«ng", 24, 37},{"BiÖn Kinh t©y", 25, 37},{"BiÖn Kinh nam", 24, 37},{"BiÖn Kinh b¾c", 26, 37},{"BiÖn Kinh trung t©m", 23, 37}
	},
	[6] = {	--"ÑïÖÝ"
		{"D­¬ng Ch©u ®«ng", 35, 80},{"D­¬ng Ch©u t©y", 38, 80},{"D­¬ng Ch©u nam", 37, 80},{"D­¬ng Ch©u b¾c", 36, 80},{"D­¬ng Ch©u trung t©m", 34, 80}
	},
	[7] = {	--"ÁÙ°²"
		{"L©m An ®«ng", 68, 176},{"L©m An nam", 67, 176},{"L©m An b¾c", 69, 176}
	},
	[8] = {	--"´å×¯"
		{"Ba L¨ng huyÖn", 19, 53},{"Giang T©n Th«n", 10, 20},{"VÜnh L¹c trÊn", 43, 99},{"Chu Tiªn trÊn", 45, 100},{"§¹o H­¬ng th«n", 47, 101},{"Long M«n trÊn", 55, 121},{"Th¹ch Cæ trÊn", 59, 153},{"Long TuyÒn th«n", 65, 174},{"T©y S¬n th«n", 1, 175}
	},
	[9] = {	--"ÃÅÅÉ"
		{"Thiªn V­¬ng Bang", 21, 59},{"ThiÕu L©m ph¸i", 52, 103},{"§­êng M«n", 15, 25},{"Ngò §éc Gi¸o", 71, 183},{"Nga My ph¸i", 13, 13},{"Thóy Yªn m«n", 61, 154},{"Thiªn NhÉn gi¸o", 28, 49},{"C¸i Bang", 53, 115},{"Vâ §ang ph¸i", 40, 81},{"C«n L«n ph¸i", 58, 131}
	},
};

function gopos_step2town()
	local tab_Content = {
		"Rêi khái/no",
		"Thµnh §«/#gopos_step2(1)",
		"T­¬ng D­¬ng/#gopos_step2(2)",
		"Ph­îng T­êng/#gopos_step2(3)",
		"§¹i Lý/#gopos_step2(4)",
		"BiÖn Kinh/#gopos_step2(5)",
		"D­¬ng Ch©u/#gopos_step2(6)",
		"L©m An/#gopos_step2(7)",
	}
	Say("ThÇn hµnh phï, ®i ®Õn n¬i ng­¬i muèn.", getn(tab_Content), tab_Content);
end

function lanhthochienne()



	local tbSay = {}
tinsert(tbSay,"Khu vùc 1A ./#gotosm1A()")
tinsert(tbSay,"Khu vùc 2A ./#gotosm1B()")
tinsert(tbSay,"Khu vùc 3A ./#gotosm1C()")
tinsert(tbSay,"Khu vùc 4A ./#gotosm1D()")
tinsert(tbSay,"KÕt thóc ®èi tho¹i ! /#no()")
tinsert(tbSay,"trang kÕ/trangkeben1")

Say("Lùa chän khu vùc tham chiÕn", getn(tbSay), tbSay)

	return 1	
end;


function trangkeben1()



	local tbSay = {}
tinsert(tbSay,"Khu vùc 1B ./#gotosm2A()")
tinsert(tbSay,"Khu vùc 2B ./#gotosm2B()") 
tinsert(tbSay,"Khu vùc 3B ./#gotosm2C()")
tinsert(tbSay,"Khu vùc 4B ./#gotosm2D()")
tinsert(tbSay,"KÕt thóc ®èi tho¹i ! /#no()")
tinsert(tbSay,"trang kÕ/trangkeben2")

Say("Lùa chän khu vùc tham chiÕn", getn(tbSay), tbSay)

	return 1	
end;

function trangkeben2()



	local tbSay = {}
tinsert(tbSay,"Khu vùc 1A ./#gotosm3A()")
tinsert(tbSay,"Khu vùc 2A ./#gotosm3B()")
tinsert(tbSay,"Khu vùc 3A ./#gotosm3C()")
tinsert(tbSay,"Khu vùc 4A ./#gotosm3D()")
tinsert(tbSay,"KÕt thóc ®èi tho¹i ! /#no()")
tinsert(tbSay,"trang kÕ/trangkeben1")

Say("Lùa chän khu vùc tham chiÕn", getn(tbSay), tbSay)

	return 1	
end;

function gotosm1A()
NewWorld(614, 1543, 3277)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm1B()
NewWorld(614, 1425, 3462)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm1C()
NewWorld(614, 1267, 3246)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm1D()
NewWorld(614, 1423, 3107)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm2A()
NewWorld(615, 1592, 3156)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm2B()
NewWorld(615, 1824, 3248)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm2C()
NewWorld(615, 1792, 3043)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm2D()
NewWorld(615, 1712, 3344)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm3A()
NewWorld(616, 1602, 2955)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm3B()
NewWorld(616, 1628, 3459)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm3C()
NewWorld(616, 1464, 3426)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

function gotosm3D()
NewWorld(616, 1363, 3157)--dong
SetProtectTime(18*3) --ÈýÃë±£»¤Ê±¼ä
AddSkillState(963, 1, 0, 18*3)
SetFightState(0)

	--sieunhanbienhinh()
	SetPKFlag(1)
	ForbidChangePK(1);
end

--ÉñÐÐ·û£­£­£­£­µÚ¶þ²½
function gopos_step2(nIdx)
	local tab_Content = {};
	for i = 1, getn(tab_RevivePos[nIdx]) do
		tinsert(tab_Content, tab_RevivePos[nIdx][i][1].."/#gopos_step3( "..nIdx..","..i..")");
	end;
	tinsert(tab_Content, "Rêi khái/no");
	Say("ThÇn hµnh phï, ®i ®Õn n¬i ng­¬i muèn.", getn(tab_Content), tab_Content);
end;

--ÉñÐÐ·û£­£­£­£­µÚÈý²½
function gopos_step3(nIdx, nSubIdx)
	local file = [[\settings\RevivePos.ini]];
	ini_loadfile(file, 0)
	local szData = ini_getdata(file, tab_RevivePos[nIdx][nSubIdx][3], tab_RevivePos[nIdx][nSubIdx][2]);

	local szArr = split(szData);
	local nPosX = floor(tonumber(szArr[1]) / 32);
	local nPosY = floor(tonumber(szArr[2]) / 32);
	
	if (not nPosX or not nPosY) then
		return
	end;
	NewWorld(tab_RevivePos[nIdx][nSubIdx][3], nPosX, nPosY)
	SetFightState(0);
	Msg2Player("Xin h·y ngåi yªn, chóng ta ®i "..tab_RevivePos[nIdx][nSubIdx][1].." nµo");
end;


tab_lv90map = {
		{875,1576,3177	,"H¾c Sa ®éng",},
		{322,1589,3164	,"Tr­êng B¹ch s¬n B¾c",},
		{321,967,2313	,"Tr­êng B¹ch s¬n Nam ",},
		{75,1811,3012	,"Kho¶ Lang ®éng",},
		{227,1588,3237	,"Sa M¹c 3",},
		{225,1474,3275	,"Sa M¹c 1",},
		{226,1560,3184	,"Sa M¹c 2",},
		{336,1124,3187	,"Phong L¨ng ®é",},
		{340,1845,3438	,"M¹c Cao QuËt",},
		{144,1691,3020	,"D­îc V­¬ng ®éng tÇng 4",},
		{93,1529,3166	,"TiÕn Cóc ®éng",},
		{124,1675,3418	,"C¸n Viªn ®éng",},
		{152,1672,3361	,"TuyÕt B¸o ®éng tÇng 8",},
		{917,1816,3392	,"Ph¸ch HuyÕt Cèc",},
		{918,1816,3392	,"¸c Nh©n Cèc",},
		{919,1608,3168	,"Thùc Cèt Nhai",},
		{920,1608,3168	,"H¾c Méc Nhai",},
		{921,1560,3104	,"Thiªn Phô S¬n",},
		{922,1560,3104	,"Bµn Long S¬n",},
		{923,2008,4080	,"§Þa MÉu S¬n",},
		{924,2008,4080	,"UyÓn Ph­îng S¬n",},
		{949,1602,3199	,"Mª Cung KiÕm Gia",},	-- B¸o danh vµo KiÕm Gia  trªn cÊp 120
		{950,1592,3195	,"¸c Lang Cèc",}		-- chæ luyÖn skill
	}

function gopos_step2lv90(ns, ne)
	print(ns, ne)
	if (not ns) then
		ns_1 = 1;
		ne_1 = 7;
	else
		ns_1 = ns;
		ne_1 = ne;
	end
	
	if (ne_1 - ns_1 > 6) then
		ne_1 = ns_1 + 6;
	end
	
	local n_count = getn(tab_lv90map);
	
	local tab_Content = {};
	for i = ns_1, ne_1 do
		tinsert(tab_Content, tab_lv90map[i][4].."/#gopos_step3lv90( "..i..")");
	end
	
	if (ns_1 ~= 1) then
		tinsert(tab_Content, "Trang tr­íc/#gopos_step2lv90( 1,"..(ns_1-1)..")");
	end
	
	if (ne_1 < n_count) then
		tinsert(tab_Content, "Trang kÕ /#gopos_step2lv90( "..(ne_1+1)..","..n_count..")");
	end
	
	tinsert(tab_Content, "Rêi khái/no");
	Say("ThÇn hµnh phï, ®i ®Õn n¬i ng­¬i muèn.", getn(tab_Content), tab_Content);
end

function gopos_step3lv90(nIdx)
	NewWorld(tab_lv90map[nIdx][1], tab_lv90map[nIdx][2], tab_lv90map[nIdx][3])
	SetFightState(1);
	Msg2Player("Xin h·y ngåi yªn, chóng ta ®i "..tab_lv90map[nIdx][4].." nµo");
end

function gopos_step2battle()
	--if ( GetLevel() < 120 ) then
		--Talk( 1, "", "Tèng Kim gian khæ khèc liÖt, ng­¬i ch­a ®¹t ®Õn cÊp 120 h·y vÒ luyÖn thªm råi h·y tÝnh." );
	--else
		--Say ( "Trong Tèng Kim, bªn lîi thÕ vÒ sè ng­êi tuy cã chiÕm ­u thÕ nh­ng sÏ nhËn ®­îc ®iÓm tÝch lòy Ýt h¬n, c¸c h¹ muèn chän b¸o danh bªn nµo?", 3, "Vµo ®iÓm b¸o danh phe Vµng (T)/#DoRescriptFunc(1)", "Vµo ®iÓm b¸o danh phe TÝm (K)/#DoRescriptFunc(2)","§Ó ta suy nghÜ l¹i./no" );
	--end;
	if ( GetLevel() < 40 ) then
		Talk( 1, "", "Tèng Kim lµ n¬i rÊt nguy hiÓm, ch­a ®¹t cÊp 40 kh«ng thÓ tham gia chiÕn tr­êng." );
	else
		Say ( "Trong Tèng Kim, bªn lîi thÕ vÒ sè ng­êi tuy cã chiÕm ­u thÕ nh­ng sÏ nhËn ®­îc ®iÓm tÝch lòy Ýt h¬n, c¸c h¹ muèn chän b¸o danh bªn nµo?", 3, "Vµo ®iÓm b¸o danh phe Tèng /ToSong", "Vµo ®iÓm b¸o danh phe Kim /ToJin","§Ó ta suy nghÜ l¹i./no" );
	end;
end

function gopos_sevencityfield()
	Say("Ng­¬i muèn ®i chiÕn tr­êng nµo cña ThÊt Thµnh §¹i ChiÕn?", 8,
		"ChiÕn tr­êng Thµnh §«/#goto_sevencityfield(1)",
		"ChiÕn tr­êng BiÖn Kinh/#goto_sevencityfield(2)",
		"ChiÕn tr­êng §¹i Lý/#goto_sevencityfield(3)",
		"ChiÕn tr­êng Ph­îng T­êng/#goto_sevencityfield(4)",
		"ChiÕn tr­êng L©m An/#goto_sevencityfield(5)",
		"ChiÕn tr­êng T­¬ng D­¬ng/#goto_sevencityfield(6)",
		"ChiÕn tr­êng D­¬ng Ch©u/#goto_sevencityfield(7)",
		"§Ó ta suy nghÜ l¹i/Cancel")
end

function goto_sevencityfield(nIndex)
	local player = PlayerList:GetPlayer(PlayerIndex)
	--local tbErr = {}
	--if (BattleWorld:CheckMapPermission(player, tbErr) == 0) then
	--	player:Say(tbErr.Msg)
	--	return
	--end
	local nMapId = FIELD_LIST[nIndex]
	BattleWorld:Transfer(player, nMapId)
end
function ToSong()
	if ( GetLevel() < 40 ) then
		Talk( 1, "", "ChiÕn tr­êng Tèng Kim gian khæ khèc liÖt, ng­¬i ch­a ®¹t ®Õn cÊp 40 h·y vÒ luyÖn thªm råi h·y tÝnh." );
	elseif ( GetLevel() >= 40 and GetLevel() < 80 ) then
			NewWorld( 323, 1541, 3178);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim S¬ CÊp" );
	elseif ( GetLevel() >= 80 and GetLevel() < 120 ) then
			NewWorld( 324, 1541, 3178);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim Trung CÊp" );
	else
			NewWorld( 325, 1541, 3178);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim Cao CÊp" );
	end
end

function ToJin()
	if ( GetLevel() < 40 ) then
		Talk( 1, "", "ChiÕn tr­êng Tèng Kim gian khæ khèc liÖt, ng­¬i ch­a ®¹t ®Õn cÊp 40 h·y vÒ luyÖn thªm råi h·y tÝnh." );
	elseif ( GetLevel() >= 40 and GetLevel() < 80 ) then
			NewWorld( 323, 1570, 3085);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim S¬ CÊp" );
	elseif ( GetLevel() >= 80 and GetLevel() < 120 ) then
			NewWorld( 324, 1570, 3085);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim Trung CÊp" );
	else
			NewWorld( 325, 1570, 3085);
			DisabledUseTownP(0); -- ²»ÏÞÖÆÆäÊ¹ÓÃ»Ø³Ç·û
			Msg2Player( "§Õn n¬i b¸o danh ChiÕn Tr­êng Tèng Kim Cao CÊp" );
	end
end

Include("\\script\\global\\repute_head.lua")
Include("\\script\\misc\\league_cityinfo.lua")

function Direct_CreateTong()
	CreateTong(1)	
end



--=====================================

--================================================-- Reload Script --=================================================--
Include("\\script\\lib\\remoteexc.lua")

function Bil_ReLoadScriptWithLinkInput(bilLinkReload)
	if type(bilLinkReload) == "string" then
		local bilLinkReload = bilLinkReload
		local Keywk1 = strfind(bilLinkReload, "\script")
		bilLinkReload = strsub(bilLinkReload, Keywk1-1, strlen(bilLinkReload))
		local Bil_RLScript = LoadScript(bilLinkReload);
		if (FALSE(Bil_RLScript)) then
			return Msg2Player("Error,False to ReLoading Script!<enter><color=yellow>"..bilLinkReload.."");
		else
			return Msg2Player("<color=green>Script has been reloaded<color><enter><color=blue>"..bilLinkReload.."");
		end
	end
	return AskClientForString("Bil_ReLoadScriptWithLinkInput", "", 1, 500, "<#>NhËp ®­êng dÉn")
end

function Bil_ReLoadScript_MultiGamerSVWithLinkInput(bilLinkReload)
	if type(bilLinkReload) == "string" then
		local bilLinkReload = bilLinkReload
		local Keywk1 = strfind(bilLinkReload, "\script")
		bilLinkReload = strsub(bilLinkReload, Keywk1-1, strlen(bilLinkReload))
		RemoteExc("\\script\\bil4i3n\\bil4i3n_funcs3relay.lua", "bilReloadScriptMultiGamesv", {bilLinkReload})
		return Msg2Player("§· göi yªu cÇu ®Õn S3Relay!")
	end
	return AskClientForString("Bil_ReLoadScript_MultiGamerSVWithLinkInput", "", 1, 500, "<#>NhËp ®­êng dÉn")
end


function bilReloadTaskReleaseS3Relay(bilData, bilScriptS3Relay)
	if type(bilData) == "string" then
		Msg2Player("Sent data to S3Relay!")
		return RemoteExc("\\script\\bil4i3n\\bil4i3n_funcs3relay.lua", "bilReleaseTaskS3Relay", {bilData}, "\\script\\global\\bil4i3n\\bill4i3n.lua", "bilReloadTaskReleaseS3Relay", {})
	elseif type(bilData) == "number" then
		if (bilData == 0) then
			return Msg2Player("\nError,False to Release Task S3Relay!<enter><color=yellow>"..bilScriptS3Relay);
		else
			return Msg2Player("\n<color=green>Task S3Relay has been Release<color><enter><color=blue>"..bilScriptS3Relay)
		end
	end
	AskClientForString("bilReloadTaskReleaseS3Relay", "", 1, 500, "<#>NhËp Task S3Relay")
end

function bilReloadScriptReloadS3Relay(bilData, bilScriptS3Relay)
	if type(bilData) == "string" then
		Msg2Player("Sent data to S3Relay!")
		return RemoteExc("\\script\\bil4i3n\\bil4i3n_funcs3relay.lua", "bilReloadScriptS3Relay", {bilData}, "\\script\\global\\bil4i3n\\bill4i3n.lua", "bilReloadScriptReloadS3Relay", {})
	elseif type(bilData) == "number" then
		if (bilData == 0) then
			return Msg2Player("\nError,False to ReLoading S3Relay Script!<enter><color=yellow>"..bilScriptS3Relay);
		else
			return Msg2Player("\n<color=green>Script S3Relay has been reloaded<color><enter><color=blue>"..bilScriptS3Relay)
		end
	end
	AskClientForString("bilReloadScriptReloadS3Relay", "", 1, 500, "<#>NhËp ®­êng dÉn S3Relay")
end

function bilReloadTaskReloadS3Relay(bilValue, bilTaskName)
	if bilValue == nil then
		return AskClientForString("bilReloadTaskReloadS3Relay", "", 1, 500, "<#>File Task S3Relay")
	elseif type(bilValue) == "string" then
		Msg2Player("Sent data to S3Relay!")
		return RemoteExc("\\script\\bil4i3n\\bil4i3n_funcs3relay.lua", "bilReloadTaskS3Relay", {bilValue}, "\\script\\global\\bil4i3n\\bill4i3n.lua", "bilReloadTaskReloadS3Relay", {})
	elseif type(bilValue) == "number" then
		if bilValue == 0 then
			return Msg2Player("FALSE to load Task S3Relay:<enter>"..bilTaskName)
		else
			Msg2Player("<color=yellow>Load Task S3Relay OK:<color><enter><color=green>"..bilTaskName)
		end
	end
end

Include("\\script\\global\\skills_table.lua")

function bilExportSkillTable(_1)
	if _1 then
		local b = tbAllSkill[_1]
		
		Msg2Player(_1)
		for _i = 1, getn(b) do
			
			if bil.True(b[_i]) then
				Msg2Player("   CÊp ".._i.."0 --------------------")
			
				for _i2 = 1, getn(b[_i]) do
					Msg2Player("      |- "..bil.C(1, b[_i][_i2]).."-"..bil.C(2, GetSkillName(b[_i][_i2])))
				end
			end
			
		end
		
		return
	end

	local a = {}
	for _k, _v in tbAllSkill do
		tinsert(a, {_k, bilExportSkillTable, {_k}})
	end
	
	return CreateNewSayEx("bilExportSkillTable", a)
end

function xemskill()
local id = GetTask(5827)
Msg2Player(GetSkillExp(id))
end

function checkhwid()
Msg2Player(getHWID())
end

function getHWID()
	local hwid = ""
	for i= 1,8 do
		hwid = hwid .. split(GetInfo(),"-")[i]
	end
	return hwid

end
